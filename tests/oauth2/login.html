<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>mastodon-api-test</title>
    <script src="../../node_modules/dev-kit/dist/dev-kit.js"></script>
  </head>
  <body>
    <dev-kit></dev-kit>
    <div class="main"></div>
  </body>
</html>


<script type="module">
import {h, app} from "../../src/hyperapp.js";
import APIUtil from "../../src/APIUtil.js";

const main_url = new URL("./main.html", location);
const oauth_url = new URL("./oauth.html", location);

const state = {
  mastodon_url: "",
  no_token: false,
}

const action = {
  onkeydown: (ev)=> (state, action)=>
    ev.keyCode === 13
    ? action.submit(state)
    : null,

  oninput: (ev)=> ()=> ({mastodon_url: ev.target.value}),
  oncheck: (ev)=> ()=> ({no_token: ev.target.checked}),

  submit: ({mastodon_url, no_token})=> (state)=>
    mastodon_url
    ? no_token
      ? location.href = main_url + `?mastodon_url=${mastodon_url}`
      : location.href = oauth_url + `?mastodon_url=${mastodon_url}`
    : null,
}

const view = (state, action)=> 
  h("div", {}, [
    h("label", {}, [
      "擬似アカウントモード",
      h("input", {
        type: "checkbox",
        onclick: (ev)=> action.oncheck(ev),
      }),
    ]),
    h("label", {}, [
      h("input", {
        type: "text",
        placeholder: "https://example.com",
        oninput: (ev)=> action.oninput(ev),
        onkeydown: (ev)=> action.onkeydown(ev),
      }),
    ]),
    h("label", {}, [
      h("input", {
        type: "button",
        value: "ログイン",
        onclick: ()=> action.submit(state),
      }),
    ]),
  ])

let ha = app(state, action, view, document.querySelector(".main"));
</script>
