<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>mastodon-api-test</title>
    <script src="../node_modules/dev-kit/dist/dev-kit.js"></script>
  </head>
  <body>
    <dev-kit></dev-kit>
    <div class="main"></div>
  </body>
</html>


<script type="module">
import APIUtil from "../src/APIUtilV2.js";
import {h, app} from "../src/hyperapp.js";
import status from "../src/view/status.js";

const state = {
  status: {
    id: "",
    uri: "",
    url: "",
    account: {},
    in_reply_to_id: "",
    in_reply_to_account_id: "",
    reblog: {},
    content: "",
    created_at: "",
    emojis: "",
    replies_count: 0,
    reblogs_count: 0,
    favourites_count: 0,
    reblogged: false,
    favourited: false,
    muted: false,
    sensitive: false,
    spoiler_text: "",
    visibility: "",
    media_attachments: [],
    mentions: [],
    tags: [],
    card: {},
    poll: {},
    application: {},
    language: "",
    pinned: false,
  }
}


const action = {
  fetch: ({mastodon_url})=> (state, action)=>
    APIUtil.url(mastodon_url)
    .timeline()
    .local()
    .then((statuses)=> action.pull(statuses[0])),

  pull: (status)=> (state)=> ({status}),
};

const view = (state, action)=>
  h("div", {}, [
    status(state.status),
  ])

window.run = ()=> {
  const mastodon_url = "https://mental.social";
  APIUtil.onresponsed = (responsed)=> console.log(responsed);
  let ha = app(state, action, view, document.querySelector(".main"));
  ha.fetch({mastodon_url});
}
</script>
