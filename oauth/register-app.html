<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
</head>
<body>
  <script src="../../node_modules/dev-kit/dist/dev-kit.js"></script>
  <dev-kit></dev-kit>
</body>
</html>


<script type="module">
import APIUtil from "../../src/APIUtil.js";

const oauth_url = new URL("./oauth.html", location);

const search = new URL(document.location).searchParams;
const mastodon_url = search.get("mastodon_url");
const redirect_uri = search.get("redirect_uri");

(async ()=> {

  if (mastodon_url && redirect_uri) {
    const {client_id, client_secret} = await APIUtil.url(mastodon_url)
    .app({
      client_name: "test",
      scopes: "read write follow",
      redirect_uris: redirect_uri,
      website: "",
    });

    oauth_url.searchParams.set("mastodon_url", mastodon_url);
    oauth_url.searchParams.set("client_id", client_id);
    oauth_url.searchParams.set("client_secret", client_secret);
    location.replace(oauth_url);
  }

})();
</script>